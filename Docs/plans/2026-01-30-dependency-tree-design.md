# 依存関係ツリー表示 設計書

## 概要
現在のフォースレイアウトグラフを階層ツリー表示に置き換える。
CLAUDE.mdをルートとして、参照関係を親→子として展開する。

## 設計決定事項
- **ルート**: CLAUDE.mdを常にルートにする
- **循環参照**: 「→循環」マークを付けて展開しない
- **UI配置**: 現在のグラフ領域をそのまま置き換え

## ツリー構造
```
CLAUDE.md (ルート)
├── 📘 skill-a.md
│   ├── 🤖 subagent-x.md
│   └── 📘 skill-b.md → 循環
├── 🤖 subagent-y.md
└── 📄 other-file.md
```

## ノードの表示
| ファイルタイプ | アイコン | 色 |
|---------------|---------|-----|
| CLAUDE.md | 📋 | 青 |
| スキル | 📘 | 緑 |
| サブエージェント | 🤖 | 紫 |
| その他 | 📄 | グレー |

- **循環参照**: `→ 循環` マークを付けて子を展開しない
- **エラー**: 参照先が見つからない場合は⚠️マーク

## インタラクション
- **展開/折りたたみ**: 各ノードの▶をクリックで子ノードを表示/非表示
- **シングルクリック**: ノード選択 → 右側の詳細パネルに情報表示
- **ダブルクリック**: エディタでファイルを開く
- **初期状態**: 第1階層まで展開済み

## 詳細パネル（右側）
- 選択ノードのパス、説明
- 参照元（このファイルを参照しているもの）
- 参照先（このファイルが参照しているもの）
- 「エディタで開く」ボタン

## 実装タスク

### 1. 型定義の更新
- `types/graph.ts`: ツリーノード型の追加

### 2. 新規コンポーネント作成
- `components/graph/DependencyTree.tsx`: メインツリーコンポーネント
- `components/graph/TreeNode.tsx`: 個別ノードコンポーネント

### 3. フック更新
- `hooks/useDependencyGraph.ts`: ツリー構造構築ロジック追加

### 4. 削除対象
- `components/graph/GraphCanvas.tsx`
- `components/graph/GraphLegend.tsx`
- `react-force-graph-2d` 依存関係
- `constants/graph.ts` のグラフ専用定数

### 5. 統合
- `DependencyGraph.tsx`: GraphCanvasをDependencyTreeに置き換え
